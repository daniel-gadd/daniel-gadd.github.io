---
layout: post
title: "Better management of ssh config files"
date: 2015-05-05 19:54:19 +1200
comments: true
categories:
 - ssh
 - linux
 - configuration
---

### Prerequisite:
For this setup im using zsh with aliases, but bash will also work.


### My ssh config setup
My ~./.ssh/config file was getting rather large and becoming a management nightmare. I have personal servers, work specific servers, domain wildcards
global wildcards etc etc. I'd estimate I had close to 30 hosts in a single file.

I decided It would be better to split my master config out into smaller logical chunks and concatinate them all together everytime I call the 'ssh' command.
This means I can easily find and logically order my Hosts in A way which works for me.

#### How does it work
I split my configuration file into 4 logical chunks (there are more, but they're business sensitive - but 4 will give you an idea):

{% codeblock %}
cat ~/.ssh/conf.d/
   000-header
   100-personal
   200-work-related
   400-global
{% endcodeblock %}

As you can see, ive used numbering to create an order in assending order. Applying the header first and finally the global config which holds the `Host *` config which get applied to everything, unless its been specified further up.

My ssh alias command calls 'cat', removes some vim comments to enable syntax highlighting and finally throws the generated file into ~/.ssh/config. Finally I call the 'ssh' command.

Heres what my zsh command alias looks like:

{% codeblock lang:bash %}
alias ssh="cat ~/.ssh/conf.d/\* |
  sed '/vim: set/d' > ~/.ssh/config &&
  chmod 0600 ~/.ssh/config && ssh"
{% endcodeblock %}

*Note: I added newlines to the code snippet so it was readable.*

### What my Host blocks look like

#####Heres my header file:

{% codeblock %}
\##################################################################
\# SSH CONFIG FILE

\# THIS FILE IS AUTOMATICALLY GENERATED - YOUR CHANGES WILL BE LOST.
\# IF YOU NEED TO CHANGE IT, CHANGE CONFIGS IN ~/.ssh/conf.d/

\# See ~/.ssh/conf.d/README.md for instructions
{% endcodeblock %}

##### global host configuration:


{% codeblock %}
\##################################################################
\# Global SSH Config - applied to all ssh commands
Host *
    ## SSH keepalive and timeout Options ##
    ServerAliveInterval 60
    ServerAliveCountMax 5
    VisualHostKey yes

    ## Channel Control Multiplexer Options ##
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 4h

    ## Specify secure ciphers and MAC algorythms
    KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
    HostKeyAlgorithms ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-rsa-cert-v00@openssh.com,ssh-ed25519,ssh-rsa
    Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
    MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-ripemd160-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,hmac-ripemd160,umac-128@openssh.com

    ## Dont hash knownhosts, so zsh autocompletion can read them ##
    HashKnownHosts no

##################################################################
{% endcodeblock %}


I hope this post has been useful to someone and thought I'd share my setup.

### In Summary
Yes theres most likely a better implimentation and yes you might see it as rough, but its a good start and good foundation to work from to make it better.

I'm still perfecting my ssh config setup and yet to run into any limitations or issues
(one issue im sure i'll encounter is rsync and scp as they wont update the config if they are called.
I guess as long as I call ssh after an update, all will be good.

I'll update here as I make better changes.
